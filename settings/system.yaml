# Consolidated System Configuration for GH200 Trading System

# System identification
system:
  name: "GH200 Trading System"
  version: "1.0.0"
  description: "High-performance trading system for NVIDIA GH200"

# Hardware settings
hardware:
  # CUDA device settings
  device: "cuda:0"
  memory_limit_mb: 80000
  num_cuda_streams: 8
  use_tensor_cores: true
  
  # CPU core allocation
  cpu_cores:
    main_thread: 2
    websocket: 3-6
    inference: 10-17
    risk: 20-23
    execution: 30-33
    monitoring: 40-41
  
  # Memory settings
  use_huge_pages: true
  preallocate_memory: true
  preallocate_size_mb: 32000
  
  # Network settings
  receive_buffer_size: 33554432
  send_buffer_size: 16777216
  tcp_nodelay: true
  
  # NUMA settings
  numa_aware: true
  numa_node_mapping:
    inference: 0-1
    websocket: 2
    risk: 3
    execution: 4
    monitoring: 5

# Data sources
data_sources:
  polygon:
    enabled: true
    api_key: "${POLYGON_API_KEY}"
    websocket_url: "wss://socket.polygon.io/stocks"
    rest_url: "https://api.polygon.io/v2"
    max_symbols: 1000
    reconnect_interval_ms: 5000
    subscription_type: "T.*"  # T.* for trades, Q.* for quotes, AM.* for minute bars

# ML model settings
ml:
  # Reference to model configuration files
  config_files:
    model_registry: "models/model_registry.json"
    training_config: "models/training_config.json"
    gbdt_config: "models/gbdt/model_config.json"
    axial_attention_config: "models/axial_attention/model_config.json"
    lstm_gru_config: "models/lstm_gru/model_config.json"

# Performance settings
performance:
  # Latency targets
  max_e2e_latency_us: 1000
  max_inference_latency_us: 500
  max_execution_latency_us: 200
  
  # Monitoring
  latency_monitoring: true
  latency_log_interval_s: 60
  performance_profiling: true
  
  # Optimization
  use_lock_free_queues: true
  use_zero_copy: true
  websocket_parser_batch_size: 1000

# Logging settings
logging:
  # General settings
  level: "INFO"
  file: "logs/trading_system.log"
  max_file_size_mb: 250  # Increased from 100MB to 250MB
  max_files: 20  # Increased from 10 to 20 files
  log_format: "[%(asctime)s] [%(levelname)s] [%(thread)d] [%(name)s] [%(filename)s:%(lineno)d] %(message)s"
  
  # Component-specific log levels
  component_levels:
    data_processor: "INFO"
    execution: "INFO"
    inference: "INFO"
    risk_manager: "INFO"
    websocket: "INFO"
    monitoring: "DEBUG"
  
  # Performance logging
  log_latency_stats: true
  log_memory_usage: true
  latency_percentiles: [50, 95, 99, 99.9]  # Track p50, p95, p99, and p99.9
  latency_log_interval_s: 60
  
  # Zero-allocation logging
  use_zero_alloc_logging: true
  preallocated_log_buffer_size: 32768  # Increased from 8192 to 32768
  flush_interval_ms: 500  # Decreased from 1000ms to 500ms for lower latency
  
  # Advanced features
  use_structured_logging: true  # Enable JSON structured logging
  enable_log_compression: true  # Compress rotated logs
  compression_method: "gzip"  # Use gzip compression
  
  # Distributed tracing
  enable_distributed_tracing: true
  trace_sampling_rate: 0.1  # Sample 10% of requests for tracing
  
  # Log rotation by time
  rotate_logs_daily: true  # Enable daily log rotation

# Trading settings
trading:
  # Account settings
  account:
    initial_capital: 25000
    max_positions: 10
    base_currency: "USD"
    account_type: "margin"
    leverage: 1.0
    
    # Position limits
    max_position_value: 2500
    min_position_value: 500
    max_positions_per_sector: 3

  # Market settings
  market:
    market_hours_only: true
    pre_market_trading: false
    after_hours_trading: false
    
    # Market hours (Eastern Time)
    market_open: "09:30"
    market_close: "16:00"
    
    # Trading universe
    symbols_file: "config/symbols.txt"
    min_price: 5.0
    max_price: 500.0
    min_volume: 500000
    min_market_cap: 500000000
    
    # Sectors/industries to include or exclude
    excluded_sectors:
      - "Cryptocurrency"
    included_sectors: []

  # Risk management
  risk:
    # Position sizing
    max_position_size_pct: 3.0
    position_sizing_method: "volatility"
    kelly_fraction: 0.3
    
    # Risk limits
    max_daily_drawdown_pct: 2.0
    max_total_risk_pct: 10.0
    correlation_threshold: 0.6
    
    # Stop loss settings
    use_stop_loss: true
    default_stop_loss_pct: 1.5
    max_stop_loss_pct: 3.0
    
    # Take profit settings
    use_take_profit: true
    default_take_profit_pct: 4.0
    min_risk_reward_ratio: 2.0
    
    # Trailing stop settings
    use_trailing_stop: true
    trailing_stop_pct: 1.0
    trailing_stop_activation_pct: 0.75
    
    # Additional risk settings
    max_sector_exposure_pct: 20.0
    max_industry_exposure_pct: 10.0
    max_overnight_positions: 5
    use_var_limits: true
    daily_var_limit_pct: 1.5

  # Order settings
  orders:
    # Order types
    default_order_type: "market"
    use_bracket_orders: true
    use_oco_orders: false
    
    # Execution settings
    time_in_force: "day"
    allow_partial_fills: true
    
    # Smart order routing
    smart_routing: false
    max_slippage_bps: 20
    
    # Rate limiting
    max_orders_per_second: 5
    max_orders_per_minute: 20

  # Trading strategies
  strategies:
    # Pattern recognition strategy
    pattern_recognition:
      enabled: true
      confidence_threshold: 0.7
      patterns:
        - "bullish_engulfing"
        - "hammer"
        - "morning_star"
        - "cup_and_handle"
        - "breakout"
    
    # Momentum strategy
    momentum:
      enabled: true
      lookback_period: 20
      threshold: 1.5
      volume_factor: 2.0
    
    # Mean reversion strategy
    mean_reversion:
      enabled: true
      zscore_threshold: 2.0
      lookback_period: 10
    
    # Strategy weights (for ensemble)
    strategy_weights:
      pattern_recognition: 0.4
      momentum: 0.3
      mean_reversion: 0.3

  # Exit conditions
  exit:
    # Time-based exits
    max_holding_time_minutes: 240
    check_exit_interval_seconds: 60
    
    # ML-based exit optimization
    use_ml_exit: true
    exit_confidence_threshold: 0.6
    
    # Market condition exits
    exit_on_high_volatility: true
    vix_threshold: 30
    
    # End of day
    close_positions_eod: true
    eod_exit_time: "15:45"

  # Broker settings
  broker:
    api_key: "${ALPACA_API_KEY}"
    api_secret: "${ALPACA_SECRET_KEY}"
    base_url: "https://paper-api.alpaca.markets"
    order_type: "market"
    max_slippage_bps: 20
